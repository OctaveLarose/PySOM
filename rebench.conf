# -*- mode: yaml -*-
# Config file for ReBench
default_experiment: all
default_data_file: 'rebench.data'

reporting:
    # Benchmark results will be reported to ReBenchDB
    rebenchdb:
        # this url needs to point to the API endpoint
        db_url: https://rebench.stefan-marr.de/rebenchdb
        repo_url: https://github.com/smarr/PySOM
        record_all: true # make sure everything is recorded
        project_name: RPySOM

runs:
    max_invocation_time: 6000
    min_iteration_time: 1

benchmark_suites:
    macro-startup:
        gauge_adapter: RebenchLog
        command: &AWFY_CMD " -cp .:Core:CD:DeltaBlue:Havlak:Json:NBody:Richards:../../../Smalltalk Harness.som  %(benchmark)s %(iterations)s "
        location: are-we-fast-yet/benchmarks/SOM
        iterations: 1
        invocations: 5
        benchmarks:
            - Richards:     {extra_args:    1, machines: [yuria ]}
            - DeltaBlue:    {extra_args:  100, machines: [yuria ]}
            - NBody:        {extra_args: 1000, machines: [yuria ]}
            - Json:         {extra_args:    1, machines: [yuria ]}

    macro-steady:
        gauge_adapter: RebenchLog
        command: *AWFY_CMD
        location: are-we-fast-yet/benchmarks/SOM
        benchmarks:
            - Richards:     {extra_args: 40,     warmup:  30,   iterations: 2000, machines: [yuria ]}
            - DeltaBlue:    {extra_args: 10000,  warmup:  20,   iterations: 2000, machines: [yuria ]}
            - NBody:        {extra_args: 250000, warmup:  20,   iterations: 2000, machines: [yuria ]}
            - Json:         {extra_args: 80,     warmup:  20,   iterations: 2000, machines: [yuria ]}


    micro-startup:
        gauge_adapter: RebenchLog
        command: *AWFY_CMD
        location: are-we-fast-yet/benchmarks/SOM
        iterations: 1
        invocations: 5
        benchmarks:
            - Bounce:       {extra_args:  10, machines: [yuria ]}
            - Permute:      {extra_args:  10, machines: [yuria ]}
            - Queens:       {extra_args:  10, machines: [yuria ]}
            - List:         {extra_args:   2, machines: [yuria ]}
            - Storage:      {extra_args:   8, machines: [yuria ]}
            - Sieve:        {extra_args:  20, machines: [yuria ]}
            - Towers:       {extra_args:   2, machines: [yuria ]}
            - Mandelbrot:   {extra_args:  50, machines: [yuria ]}

    micro-steady:
        gauge_adapter: RebenchLog
        command: *AWFY_CMD
        location: are-we-fast-yet/benchmarks/SOM
        benchmarks:
            - Bounce:       {extra_args: 4000,   warmup:  10,   iterations: 2000, machines: [yuria ]}
            - Permute:      {extra_args: 1500,   warmup:   5,   iterations: 2000, machines: [yuria ]}
            - Queens:       {extra_args: 1000,   warmup:   5,   iterations: 2000, machines: [yuria ]}
            - List:         {extra_args: 1000,   warmup:  15,   iterations: 2000, machines: [yuria ]}
            - Storage:      {extra_args: 1000,   warmup:  10,   iterations: 2000, machines: [yuria ]}
            - Sieve:        {extra_args: 2500,   warmup:  10,   iterations: 2000, machines: [yuria ]}
            - Towers:       {extra_args: 1000,   warmup:   5,   iterations: 2000, machines: [yuria ]}
            - Mandelbrot:   {extra_args: 1000,   warmup:  10,   iterations: 2000, machines: [yuria ]}

executors:
    RPySOM-ast-interp:
        path: .
        executable: som-ast-interp
    RPySOM-bc-interp:
        path: .
        executable: som-bc-interp
    RPySOM-ast-jit:
        path: .
        executable: som-ast-jit
    RPySOM-bc-jit:
        path: .
        executable: som-bc-jit

    SomSom-ast-interp:
        path: .
        executable: som-ast-interp
        args: "-cp core-lib/Smalltalk:core-lib/TestSuite:core-lib/SomSom/src/compiler:core-lib/SomSom/src/vm:core-lib/SomSom/src/vmobjects:core-lib/SomSom/src/interpreter:core-lib/SomSom/src/primitives core-lib/SomSom/src/vm/MainLoadAll.som"
    SomSom-bc-interp:
        path: .
        executable: som-bc-interp
        args: "-cp core-lib/Smalltalk:core-lib/TestSuite:core-lib/SomSom/src/compiler:core-lib/SomSom/src/vm:core-lib/SomSom/src/vmobjects:core-lib/SomSom/src/interpreter:core-lib/SomSom/src/primitives core-lib/SomSom/src/vm/MainLoadAll.som"


# define the benchmarks to be executed for a re-executable benchmark run
experiments:
    RPySOM:
        description: All benchmarks on RPySOM (AST and Bytecode Interpreters)
        executions:
            - RPySOM-ast-interp:
                suites:
                    - micro-startup
                    - macro-startup
            - RPySOM-bc-interp:
                suites:
                    - micro-startup
                    - macro-startup
            - RPySOM-ast-jit:
                suites:
#                    - micro-startup
                    - micro-steady
#                    - macro-startup
                    - macro-steady
            - RPySOM-bc-jit:
                suites:
#                    - micro-startup
                    - micro-steady
#                    - macro-startup
                    - macro-steady
